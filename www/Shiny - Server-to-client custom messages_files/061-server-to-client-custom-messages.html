<!DOCTYPE html>
<!-- saved from url=(0066)https://gallery.shinyapps.io/061-server-to-client-custom-messages/ -->
<html class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<base href="_w_4dcb31bf/">--><base href=".">
    <script type="text/javascript">
(function() {
  // http://stackoverflow.com/questions/10964966/detect-ie-version-in-javascript
  function isIE () {
    var myNav = navigator.userAgent.toLowerCase();
    return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;
  }

  if (isIE() === 8 || isIE() === 9){
    // Set an absolute base href.
    baseURL = document.URL;
    baseURL = baseURL.substring(0, baseURL.lastIndexOf('/'));
    document.getElementsByTagName('base')[0].setAttribute('href', baseURL + '/_w_4dcb31bf/');
  }
})();
</script>

      <script type="text/javascript">
      var __connect = {
        shiny: '1.0.3'
      }
      </script>
      

    <script type="application/shiny-singletons">321b0ac180cf2053358820f06a720ed5d9e7b825</script>  <script type="application/html-dependencies">json2[2014.02.04];jquery[1.12.4];shiny[1.0.3];jqueryui[1.12.1];showdown[0.3.1];highlight.js[6.2];ionrangeslider[2.1.6];strftime[0.9.2];bootstrap[3.3.7];font-awesome[4.7.0]</script><script src="./json2-min.js"></script>
<script src="./jquery.min.js"></script>
<link href="./shiny.css" rel="stylesheet">
<script src="./shiny.min.js"></script>
<script src="./jquery-ui.min.js"></script>
<script src="./showdown.js"></script>
<script src="./highlight.pack(1).js"></script>
<link href="./ion.rangeSlider.css" rel="stylesheet">
<link href="./ion.rangeSlider.skinShiny.css" rel="stylesheet">
<script src="./ion.rangeSlider.min.js"></script>
<script src="./strftime-min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="./bootstrap.min(1).css" rel="stylesheet">
<script src="./bootstrap.min(2).js"></script>
<script src="./html5shiv.min.js"></script>
<script src="./respond.min(1).js"></script>
<link href="./font-awesome.min(1).css" rel="stylesheet">  <script src="./shiny-showcase.js"></script>
  <link rel="stylesheet" type="text/css" href="./rstudio(1).css">
  <link rel="stylesheet" type="text/css" href="./shiny-showcase.css">
  <script type="text/markdown" id="showcase-markdown-content">Sometimes it's useful to send messages from the server to the client, in a way that can't easily be handled with the usual Shiny output bindings.

`sendCustomMessage()` sends information from the server to the client. It's typically used inside an `observe()` statement. The message is converted from an R data structure to JSON using `RJSONIO::toJSON()`.

On the client side, a message handler function must be registered to receive and do something with the message. Here, the Javascript file (in the www/ directory) which registers the handler gets included in the head of the HTML page. (Make sure to look at the full source code to see the Javascript file.)

In this example, the message handler simply pops up an alert box which displays the content of the message.</script>
  <title>sendCustomMessage example</title>
  <script src="./message-handler.js"></script>

<script src="./sockjs-0.3.min.js"></script>
<script src="./shiny-server-client.js"></script>
<script>preShinyInit({reconnect:false,reconnectTimeout:0,disableProtocols:[],transportDebugging:false,token:true,workerId:true,subappTag:true,extendSession:true,fixupInternalLinks:true});</script>
<link rel="stylesheet" type="text/css" href="./rstudio-connect.css">
<link rel="stylesheet" type="text/css" href="./shinyapps.css"></head>

<body>
<script type="text/javascript" src="./iframeResizer.contentWindow.min.js"></script>
<script type="text/javascript" src="./shinyapps.frame.content.js"></script>
<script type="text/javascript" src="./shinyapps.js"></script>

  <table id="showcase-app-code">
    <tbody><tr>
      <td id="showcase-app-container" class="showcase-app-container-expanded" style="zoom: 100%; width: 960px;">
        <div class="container-fluid">
          <h2>sendCustomMessage example</h2>
          <div class="row">
            <div class="col-sm-4">
              <div class="well">
                <div class="form-group shiny-input-container">
                  <label class="control-label" for="controller">Controller:</label>
                  <span class="irs js-irs-0 irs-with-grid"><span class="irs"><span class="irs-line" tabindex="-1"><span class="irs-line-left"></span><span class="irs-line-mid"></span><span class="irs-line-right"></span></span><span class="irs-min" style="visibility: visible;">1</span><span class="irs-max" style="visibility: visible;">20</span><span class="irs-from" style="visibility: hidden;">0</span><span class="irs-to" style="visibility: hidden;">0</span><span class="irs-single" style="left: 68%;">15</span></span><span class="irs-grid" style="width: 91.2%; left: 4.3%;"><span class="irs-grid-pol" style="left: 0%"></span><span class="irs-grid-text js-grid-text-0" style="left: 0%; margin-left: -2.2%;">1</span><span class="irs-grid-pol small" style="left: 7.017543859649123%"></span><span class="irs-grid-pol small" style="left: 3.5087719298245617%"></span><span class="irs-grid-pol" style="left: 10.526315789473685%"></span><span class="irs-grid-text js-grid-text-1" style="left: 10.5263%; visibility: visible; margin-left: -2.2%;">3</span><span class="irs-grid-pol small" style="left: 17.54385964912281%"></span><span class="irs-grid-pol small" style="left: 14.035087719298247%"></span><span class="irs-grid-pol" style="left: 21.05263157894737%"></span><span class="irs-grid-text js-grid-text-2" style="left: 21.0526%; visibility: visible; margin-left: -2.2%;">5</span><span class="irs-grid-pol small" style="left: 28.070175438596493%"></span><span class="irs-grid-pol small" style="left: 24.56140350877193%"></span><span class="irs-grid-pol" style="left: 31.578947368421055%"></span><span class="irs-grid-text js-grid-text-3" style="left: 31.5789%; visibility: visible; margin-left: -2.2%;">7</span><span class="irs-grid-pol small" style="left: 38.59649122807018%"></span><span class="irs-grid-pol small" style="left: 35.08771929824562%"></span><span class="irs-grid-pol" style="left: 42.10526315789474%"></span><span class="irs-grid-text js-grid-text-4" style="left: 42.1053%; margin-left: -2.2%;">9</span><span class="irs-grid-pol small" style="left: 49.12280701754386%"></span><span class="irs-grid-pol small" style="left: 45.6140350877193%"></span><span class="irs-grid-pol" style="left: 52.631578947368425%"></span><span class="irs-grid-text js-grid-text-5" style="left: 52.6316%; visibility: visible; margin-left: -3%;">11</span><span class="irs-grid-pol small" style="left: 59.64912280701755%"></span><span class="irs-grid-pol small" style="left: 56.140350877192986%"></span><span class="irs-grid-pol" style="left: 63.15789473684211%"></span><span class="irs-grid-text js-grid-text-6" style="left: 63.1579%; visibility: visible; margin-left: -3.2%;">13</span><span class="irs-grid-pol small" style="left: 70.17543859649123%"></span><span class="irs-grid-pol small" style="left: 66.66666666666667%"></span><span class="irs-grid-pol" style="left: 73.6842105263158%"></span><span class="irs-grid-text js-grid-text-7" style="left: 73.6842%; visibility: visible; margin-left: -3.2%;">15</span><span class="irs-grid-pol small" style="left: 80.70175438596492%"></span><span class="irs-grid-pol small" style="left: 77.19298245614036%"></span><span class="irs-grid-pol" style="left: 84.21052631578948%"></span><span class="irs-grid-text js-grid-text-8" style="left: 84.2105%; margin-left: -3.2%;">17</span><span class="irs-grid-pol small" style="left: 91.2280701754386%"></span><span class="irs-grid-pol small" style="left: 87.71929824561404%"></span><span class="irs-grid-pol" style="left: 94.73684210526316%"></span><span class="irs-grid-text js-grid-text-9" style="left: 94.7368%; visibility: visible; margin-left: -3.2%;">19</span><span class="irs-grid-pol" style="left: 100%"></span><span class="irs-grid-text js-grid-text-10" style="left: 100%; visibility: visible; margin-left: -3.2%;">20</span></span><span class="irs-bar" style="left: 4.4%; width: 67.2%;"></span><span class="irs-bar-edge"></span><span class="irs-shadow shadow-single" style="display: none;"></span><span class="irs-slider single" style="left: 67.2%;"></span></span><input class="js-range-slider irs-hidden-input shiny-bound-input" id="controller" data-min="1" data-max="20" data-from="15" data-step="1" data-grid="true" data-grid-num="9.5" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-keyboard-step="5.26315789473684" data-data-type="number" readonly="">
                </div>
              </div>
            </div>
          </div>
        </div>
        </td><td id="showcase-sxs-code" class="showcase-sxs-code-collapsed" style="display: table-cell;"><div id="showcase-code-tabs">
          <a id="showcase-code-position-toggle" class="btn btn-default btn-sm" onclick="toggleCodePosition()"><i class="fa fa-level-down"></i> show below</a>
          <ul class="nav nav-tabs">
            <li class="active">
              <a href="https://gallery.shinyapps.io/061-server-to-client-custom-messages/_w_4dcb31bf/#server_R_code" data-toggle="tab">server.R</a>
            </li>
            <li class="">
              <a href="https://gallery.shinyapps.io/061-server-to-client-custom-messages/_w_4dcb31bf/#ui_R_code" data-toggle="tab">ui.R</a>
            </li>
            <li role="presentation" class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="https://gallery.shinyapps.io/061-server-to-client-custom-messages/_w_4dcb31bf/#" role="button" aria-haspopup="true" aria-expanded="false">
                www
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <li class="">
                  <a href="https://gallery.shinyapps.io/061-server-to-client-custom-messages/_w_4dcb31bf/#message-handler_js_code" data-toggle="tab">message-handler.js</a>
                </li>
              </ul>
            </li>
          </ul>
          <div class="tab-content" id="showcase-code-content" style="height: 885px;">
            <div class="tab-pane active" id="server_R_code">
              <pre class="shiny-code"><code class="language-r"><span class="keyword">function</span><span class="paren">(</span><span class="identifier">input</span>, <span class="identifier">output</span>, <span class="identifier">session</span><span class="paren">)</span> <span class="paren">{</span>
  <span class="comment"># An observer is used to send messages to the client.</span>
  <span class="comment"># The message is converted to JSON</span>
  <span class="identifier">observe</span><span class="paren">(</span><span class="paren">{</span>
    <span class="identifier">session</span><span class="operator">$</span><span class="identifier">sendCustomMessage</span><span class="paren">(</span><span class="identifier">type</span> <span class="operator">=</span> <span class="string">'testmessage'</span>,
      <span class="identifier">message</span> <span class="operator">=</span> <span class="identifier">list</span><span class="paren">(</span><span class="identifier">a</span> <span class="operator">=</span> <span class="number">1</span>, <span class="identifier">b</span> <span class="operator">=</span> <span class="string">'text'</span>,
                     <span class="identifier">controller</span> <span class="operator">=</span> <span class="identifier">input</span><span class="operator">$</span><span class="identifier">controller</span><span class="paren">)</span><span class="paren">)</span>
  <span class="paren">}</span><span class="paren">)</span>
<span class="paren">}</span></code></pre>
            </div>
            <div class="tab-pane" id="ui_R_code">
              <pre class="shiny-code"><code class="language-r"><span class="identifier">fluidPage</span><span class="paren">(</span>
  <span class="identifier">titlePanel</span><span class="paren">(</span><span class="string">"sendCustomMessage example"</span><span class="paren">)</span>,

  <span class="identifier">fluidRow</span><span class="paren">(</span>
    <span class="identifier">column</span><span class="paren">(</span><span class="number">4</span>, <span class="identifier">wellPanel</span><span class="paren">(</span>
      <span class="identifier">sliderInput</span><span class="paren">(</span><span class="string">"controller"</span>, <span class="string">"Controller:"</span>,
        <span class="identifier">min</span> <span class="operator">=</span> <span class="number">1</span>, <span class="identifier">max</span> <span class="operator">=</span> <span class="number">20</span>, <span class="identifier">value</span> <span class="operator">=</span> <span class="number">15</span><span class="paren">)</span>,
      
      <span class="comment"># This makes web page load the JS file in the HTML head.</span>
      <span class="comment"># The call to singleton ensures it's only included once</span>
      <span class="comment"># in a page. It's not strictly necessary in this case, but</span>
      <span class="comment"># it's good practice.</span>
      <span class="identifier">singleton</span><span class="paren">(</span>
        <span class="identifier">tags</span><span class="operator">$</span><span class="identifier">head</span><span class="paren">(</span><span class="identifier">tags</span><span class="operator">$</span><span class="identifier">script</span><span class="paren">(</span><span class="identifier">src</span> <span class="operator">=</span> <span class="string">"message-handler.js"</span><span class="paren">)</span><span class="paren">)</span>
      <span class="paren">)</span>
    <span class="paren">)</span><span class="paren">)</span>
  <span class="paren">)</span>
<span class="paren">)</span></code></pre>
            </div>
            <div class="tab-pane" id="message-handler_js_code">
              <pre class="shiny-code"><code class="language-javascript"><span class="comment">// This recieves messages of type "testmessage" from the server.</span>
Shiny.addCustomMessageHandler(<span class="string">"testmessage"</span>,
  <span class="keyword">function</span>(message) {
    alert(JSON.stringify(message));
  }
);</code></pre>
            </div>
          </div>
          <small class="showcase-code-license text-muted">
            Code license: 
            <a href="http://www.r-project.org/Licenses/MIT">MIT</a>
          </small>
        </div></td>
      
    </tr>
  </tbody></table>
  <div class="container-fluid shiny-code-container well" id="showcase-well">
    <div class="row">
      <div id="showcase-app-metadata" class="col-sm-4">
        <h4 class="text-muted shiny-showcase-apptitle">
          Server-to-client custom messages
          <small>
            <br>
            by
            <a href="http://www.rstudio.com/" class="shiny-showcase-appauthor">Winston Chang &lt;winston@rstudio.com&gt;</a>
            
          </small>
        </h4>
        
      </div>
      <div id="showcase-code-inline" class="col-sm-8" style="display: block;">
        
      <div id="readme-md"><p>Sometimes it's useful to send messages from the server to the client, in a way that can't easily be handled with the usual Shiny output bindings.</p>

<p><code>sendCustomMessage()</code> sends information from the server to the client. It's typically used inside an <code>observe()</code> statement. The message is converted from an R data structure to JSON using <code>RJSONIO::toJSON()</code>.</p>

<p>On the client side, a message handler function must be registered to receive and do something with the message. Here, the Javascript file (in the www/ directory) which registers the handler gets included in the head of the HTML page. (Make sure to look at the full source code to see the Javascript file.)</p>

<p>In this example, the message handler simply pops up an alert box which displays the content of the message.</p></div></div>
    </div>
  </div>



<div id="ss-connect-dialog" style=""><label>Disconnected from the server.</label> <a id="ss-reload-link" href="https://gallery.shinyapps.io/061-server-to-client-custom-messages/_w_4dcb31bf/#" class="ss-dialog-link">Reload</a></div><div id="ss-overlay" class="ss-gray-out" style=""></div><div id="shiny-disconnected-overlay"></div></body></html>